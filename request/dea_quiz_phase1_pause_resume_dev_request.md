# 開発依頼書：DEAクイズアプリ Phase 1-①「回答中断/再開」機能（Codex向け）

作成日：2026-02-14  
対象リポジトリ：`quiz-practice` / `dea-quiz-app`  
対象URL： https://github.com/yuyuyu0706/quiz-practice/tree/main/dea-quiz-app  
依頼者：草野  
実装担当：Codex

---

## 1. 目的
DEAクイズWebアプリに、**回答途中で中断しても、次回同じ状態から再開できる機能**を追加する。  
学習継続性を高めるため、**中断状態（セッション）をlocalStorageに保存**し、復元する。

---

## 2. スコープ（今回やること）
### 2.1 実装対象
- 「回答中断/再開」機能（Phase 1 のうち **①のみ**）
- 保存先：`localStorage`
- 対象画面：ホーム/設定画面、クイズ画面（最低限）

### 2.2 今回やらないこと（明確に除外）
- ②「選択肢の並びランダム化」
- ⑤/⑥/⑦などの追加機能
- サーバサイド実装
- 学習履歴の高度な集計（既存があれば壊さない）

---

## 3. 要件定義

## 3.1 ユーザーストーリー
- 学習者として、クイズの途中でアプリを閉じたりリロードしても、**同じ出題順・同じ進捗・同じ回答状況**から再開したい。
- 学習者として、中断したセッションがある場合はホームに「続きから再開」が表示されてほしい。
- 学習者として、セッションを破棄して最初からやり直す（リセット）こともできると嬉しい（MVPとして簡易でOK）。

---

## 3.2 中断/再開の「同じ状態」の定義（保存・復元対象）
必須（MVPで必ず復元すべき）
- 出題リスト（問題ID配列）  
  - ランダム出題等がある場合でも、復元後は同じ順番で再開できること
- 現在の問題インデックス（0-based / 1-based は実装に合わせる）
- 各問題の回答状況
  - 未回答/回答済み
  - 選んだ選択肢（A/B/C/D）
  - 正誤（または採点可能な情報）
- クイズ開始時刻（任意だが推奨：後で模試機能に拡張しやすい）

できれば（余力があれば）
- 「解説を表示中かどうか」のUI状態（表示/非表示）
- 「結果画面に遷移済みか」などのフラグ  
  ※ただし仕様が複雑になるなら今回は不要

---

## 3.3 画面・UI要件
### ホーム/設定画面
- 中断セッションが存在する場合：
  - 「続きから再開」ボタンを表示
  - 「中断データを削除（やり直し）」ボタンを表示（任意だが推奨）
- 中断セッションが無い場合：
  - 「続きから再開」は非表示（またはdisabled）

### クイズ画面
- 「中断して戻る」ボタンを追加（ラベル例：`中断してホームへ`）
  - 押下で、現在状態を保存 → ホームへ遷移
- ブラウザを閉じる/リロードする場合に備え、**回答確定時・ページ遷移時にも自動保存**する（推奨）
  - 最低限：回答確定時に保存

---

## 3.4 保存先（localStorage）
- 保存キー（例）：`deaQuizActiveSession`
  - 既存のキーがあればそれに合わせ、衝突しない名前にする
- JSONで保存（UTF-8）

### セッションデータ（案：必要に応じて変更可）
```json
{
  "schemaVersion": 1,
  "app": "dea-quiz-app",
  "savedAt": "2026-02-14T12:34:56.000Z",
  "settingsSnapshot": {
    "mode": "ordered",
    "sections": ["1","2","3","4","5"],
    "count": 50
  },
  "questionOrder": ["Q1","Q2","Q3"],
  "currentIndex": 1,
  "answers": {
    "Q1": { "selected": "C", "isCorrect": true, "answeredAt": "..." },
    "Q2": { "selected": "A", "isCorrect": false, "answeredAt": "..." }
  },
  "startedAt": "2026-02-14T12:00:00.000Z"
}
```

#### 注意
- `questionOrder` と `answers` は必須  
- `settingsSnapshot` は任意（復元時の表示に使えれば便利）

---

## 4. 機能仕様（振る舞い）

## 4.1 再開ボタンの挙動
- ホームで「続きから再開」を押すと：
  1) localStorage からセッションを読み込み
  2) セッション妥当性チェック（最低限）
     - `questionOrder` が配列
     - `currentIndex` が範囲内
  3) クイズ画面へ遷移し、該当問題を表示
  4) 回答済みの問題は、選択肢が選択済み・正誤表示が再現される（可能な範囲で）

## 4.2 中断ボタンの挙動
- クイズ画面で「中断してホームへ」押下：
  - 現在の状態を保存（`savedAt`更新）
  - ホームへ戻る

## 4.3 セッション削除（任意）
- ホームで「中断データを削除」押下：
  - `deaQuizActiveSession` を削除
  - UIを更新（再開ボタン非表示）

## 4.4 セッション完了時の扱い
- クイズが最後まで完了し、結果画面に到達した時：
  - 原則：セッションを削除（再開不要のため）
  - ただし、結果画面から「見直し」導線がある場合は、削除タイミングは実装に合わせる
  - 今回は **完了＝セッション削除** を推奨

---

## 5. 受け入れ条件（Acceptance Criteria）
- [ ] 途中まで回答した状態で「中断してホームへ」を押すと、セッションが保存される
- [ ] ブラウザをリロード/タブを閉じても、ホームに「続きから再開」が表示される
- [ ] 「続きから再開」で、同じ出題順・同じ進捗・同じ回答状況で復元できる
- [ ] クイズ完了（結果画面到達）後は、基本的に中断セッションが消える（再開ボタンが出ない）
- [ ] 既存機能（通常開始・採点・結果表示）を壊さない

---

## 6. 実装メモ（Codex向けヒント）
- アプリ状態（state）をまとめたオブジェクトを作り、`saveSession(state)` / `loadSession()` を切り出すと保守が楽
- 回答確定時（submit/next）に `saveSession()` を呼び出す
- UI初期化時（ホーム表示時）に「セッション存在チェック」を行い、再開ボタンを出し分ける
- セッションの `schemaVersion` を入れておくと将来拡張に強い

---

## 7. 成果物
- コード変更（既存ファイルへの追記）
  - `app.js`（または現状のメインJS）
  - `index.html`（ボタン追加）
  - `styles.css`（必要なら）
- README更新（任意）
  - 「中断/再開」の使い方
  - localStorage リセット方法（キー名含む）

---

## 8. テスト観点（手動でOK）
- 途中回答 → 中断 → 再開 → 正誤表示が復元される
- 途中回答 → リロード → 再開できる
- 完了後 → 再開ボタンが出ない
- セッション破損（localStorageのJSONが壊れている）時は安全に無視して新規開始できる
