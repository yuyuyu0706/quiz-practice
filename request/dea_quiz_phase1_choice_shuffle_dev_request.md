# 開発依頼書：DEAクイズアプリ Phase 1-②「選択肢ランダム化」機能（Codex向け）

作成日：2026-02-14  
対象リポジトリ：`quiz-practice` / `dea-quiz-app`  
対象URL： https://github.com/yuyuyu0706/quiz-practice/tree/main/dea-quiz-app  
依頼者：草野  
実装担当：Codex

---

## 1. 目的
DEAクイズWebアプリに、**選択肢（A〜D）の表示順をランダム化**する機能を追加し、  
「位置暗記（いつもCが正解っぽい等）」を防ぎ、理解ベースで解く学習を促進する。

---

## 2. スコープ（今回やること）
### 2.1 実装対象
- クイズ画面で表示する**選択肢の並びを毎回シャッフル**する
- 正誤判定がズレないように、**正解情報がシャッフルに追従**すること
- Phase 1-①（回答中断/再開）と整合させる  
  - 中断→再開後も、同じ問題について**同じ並びが再現**される（必須）

### 2.2 今回やらないこと
- 出題順（問題順）のランダム化の強化（別機能）
- SRS等の学習アルゴリズム
- 結果エクスポ/インポ

---

## 3. 要件定義

## 3.1 ユーザーストーリー
- 学習者として、同じ問題でも選択肢の位置が固定されないことで、記憶の偏りを避けたい。
- 学習者として、中断→再開した際に、選択肢の並びが変わって混乱したくない（再開時は同じ並びが良い）。

---

## 3.2 振る舞い（仕様）
### 基本
- 各問題の選択肢（A/B/C/D）を、表示時にシャッフルする
- シャッフル後も、採点は正しい（元の `answer` と一致する選択肢を正解として扱う）

### 再現性（重要）
- **同一セッション内**では、同じ問題を表示するたびに並びが変わらないこと（推奨）
- **中断→再開**でも並びが変わらないこと（必須）
  - これができないと、保存していた「ユーザーの選択」がどの選択肢に対応するか分からなくなる

---

## 4. 実装方針（推奨）
以下のいずれかの方式で実装する。**方式A推奨**。

### 方式A：問題ごとに「シャッフル結果」を保存する（推奨）
- セッション（localStorage）の中に、問題IDごとに「表示順」を保存する
- 例：
```json
"choiceOrder": {
  "Q1": ["C","A","D","B"],
  "Q2": ["B","D","A","C"]
}
```
- 表示時：
  - `choiceOrder[Qn]` があれば、その順で表示
  - なければ生成（Fisher–Yates）して保存

**メリット**
- 再開で確実に再現できる
- シード管理が不要で実装が簡単

**注意**
- セッション保存/復元対象に `choiceOrder` を追加する（Phase 1-①との統合）

### 方式B：セッションごとに乱数シードを持ち、問題IDから決定的に並びを生成
- `seed` を保存し、`shuffle(questionId, seed)` のように決定的シャッフル
- 実装がやや難しいため今回は非推奨（将来の拡張には良い）

---

## 5. データ構造の変更（localStorage セッション）
Phase 1-① で保存しているセッションに、以下を追加。

- `choiceOrder`（必須）
  - 問題ID → 選択肢キー配列（A/B/C/Dの並び）
- 既存の `answers` は「選択肢キー（A/B/C/D）」で保存し続ける（推奨）
  - 例：`answers.Q1.selected = "C"`

### セッション例（差分）
```json
{
  "questionOrder": ["Q1","Q2"],
  "currentIndex": 0,
  "answers": { "Q1": { "selected": "C", "isCorrect": true } },
  "choiceOrder": { "Q1": ["C","A","D","B"] }
}
```

---

## 6. UI仕様
- 見た目は現状のままでOK（並びだけ変える）
- **重要**：ユーザーが選んだものは「元の選択肢キー（A/B/C/D）」として保存すること  
  （表示順が変わっても、保存される selected は不変）

---

## 7. 受け入れ条件（Acceptance Criteria）
- [ ] 各問題の選択肢がランダム順に表示される
- [ ] 正解判定が常に正しい（シャッフルでズレない）
- [ ] 同じセッション内で、同じ問題の並びが変わらない（推奨）
- [ ] 中断→再開後も、同じ問題の並びが再現される（必須）
- [ ] 回答済み問題を再表示した際、選択済み状態が正しく復元される
- [ ] 既存機能（採点/結果/中断再開）を壊さない

---

## 8. 実装メモ（Codex向け）
- シャッフルは Fisher–Yates 推奨
- `renderQuestion(questionId)` の直前に `getChoiceOrder(questionId)` を用意し、表示順を確定
- 表示用の選択肢配列を以下の形にすると安全：
```js
[
  { key: "C", text: choices["C"], isCorrect: (key === answer) },
  ...
]
```
- ユーザーがクリックした時は `key` を保存する（表示indexでは保存しない）

---

## 9. 成果物
- コード変更
  - `app.js`（選択肢の生成/描画/保存/復元）
  - （必要なら）`index.html` / `styles.css`
- README更新（任意）
  - 「選択肢はランダム表示」「中断再開で並び維持」の説明

---

## 10. テスト観点（手動）
1) 同じ問題を「前へ/次へ」で行き来しても並びが変わらない  
2) 回答して正誤が正しい  
3) 中断→再開しても並びが同じ  
4) 回答済みの選択肢が再開後も選択済みとして復元される  
5) セッション削除後は、並びが新しく生成される（新規セッションとして扱う）

